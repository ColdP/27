<!DOCTYPE html>
<html lang="zh-TW" class="antialiased">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>27 -DECO*27 Vocal Mix-</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 使用 Inter 字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Noto+Sans+SC:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- 引入 Material Symbols Rounded -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@40,400,1,0" />
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Inter"', '-apple-system', 'BlinkMacSystemFont', '"Segoe UI"', 'Roboto', '"Noto Sans SC"', '"Noto Sans JP"', 'sans-serif'],
                    },
                    colors: {
                        'apple-gray': '#f5f5f7',
                        'apple-dark': '#1c1c1e',
                        'apple-pink': '#fa2d48',
                        'glass-light': 'rgba(255, 255, 255, 0.7)',
                        'glass-dark': 'rgba(30, 30, 30, 0.6)',
                    },
                    boxShadow: {
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.07)',
                        'float': '0 20px 40px -10px rgba(0,0,0,0.15)',
                    },
                    animation: {
                        'blob': 'blob 10s infinite',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Material Symbols 样式微调 */
        .material-symbols-rounded {
            font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 40;
            user-select: none; /* 防止图标被选中 */
        }
        
        /* 自定义滚动条 - 隐藏但保留功能 */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* 范围滑块样式 (Apple Style) */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%;
            background: #fff; cursor: pointer; margin-top: -6px; 
            box-shadow: 0 2px 6px rgba(0,0,0,0.2); 
            transform: scale(0); transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .group:hover input[type=range]::-webkit-slider-thumb { transform: scale(1); }
        
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer; 
            background: rgba(255,255,255,0.3); border-radius: 2px;
        }

        /* 歌词容器样式 */
        .lyrics-container {
            mask-image: linear-gradient(to bottom, transparent 0%, black 15%, black 85%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 15%, black 85%, transparent 100%);
            scroll-behavior: smooth; 
        }

        .lyrics-row {
            transition: all 0.6s cubic-bezier(0.33, 1, 0.68, 1); 
            transform-origin: left center;
            opacity: 0.4;
            transform: scale(0.95);
            filter: blur(0.8px);
        }
        
        .lyrics-row.active {
            opacity: 1;
            transform: scale(1);
            filter: blur(0px);
            text-shadow: 0 0 30px rgba(255,255,255,0.2);
        }
        
        /* 创作者信息样式 (无模糊，无高亮) */
        .lyrics-footer {
            opacity: 0.5;
            transform: scale(1);
            filter: blur(0); 
            cursor: default;
        }

        .lyrics-row:hover {
            opacity: 0.8;
            filter: blur(0px);
            background-color: rgba(255,255,255,0.05);
        }
        
        /* Footer row hover override */
        .lyrics-footer:hover {
            background-color: transparent;
            opacity: 0.5;
        }

        /* 动态背景模糊球 */
        .bg-blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.6;
            z-index: -1;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="bg-black min-h-screen text-white font-sans overflow-hidden flex flex-col transition-colors duration-700">
    
    <!-- 动态背景 -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="bg-blob bg-pink-600 w-96 h-96 top-0 -left-20 animate-blob"></div>
        <div class="bg-blob bg-purple-600 w-96 h-96 bottom-0 -right-20 animate-blob" style="animation-delay: 2s"></div>
        <div class="bg-blob bg-rose-500 w-80 h-80 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 animate-blob" style="animation-delay: 4s"></div>
        <div class="absolute inset-0 bg-black/30 backdrop-blur-3xl"></div>
    </div>

    <!-- 顶部导航 -->
    <nav class="w-full px-6 py-6 flex justify-center items-center z-20 relative">
        <div class="glass-panel rounded-full p-1 flex space-x-1">
            <button class="lang-btn px-3 py-1 rounded-full text-xs font-semibold transition-all duration-300 hover:bg-white/10 text-white/60" data-lang="jp">JP</button>
            <button class="lang-btn px-3 py-1 rounded-full text-xs font-semibold transition-all duration-300 hover:bg-white/10 text-white/60" data-lang="cn">CN</button>
            <button class="lang-btn px-3 py-1 rounded-full text-xs font-semibold transition-all duration-300 hover:bg-white/10 text-white/60" data-lang="en">EN</button>
        </div>
    </nav>

    <!-- 主要内容区 (Changed md:items-start to md:items-center for alignment) -->
    <main class="flex-grow flex flex-col md:flex-row items-center md:items-center justify-center px-6 md:px-12 pb-12 md:pb-0 z-10 w-full max-w-7xl mx-auto gap-8 md:gap-20 h-full overflow-hidden">
        
        <!-- 左侧：封面、信息、播放控制 -->
        <div class="flex-shrink-0 flex flex-col items-center md:items-start md:justify-center md:h-full md:w-[320px] lg:w-[380px] space-y-8 max-w-sm mx-auto md:mx-0">
            <!-- 封面 (移除 padding 和 hover scale) -->
            <div class="relative w-64 h-64 md:w-full md:h-auto md:aspect-square rounded-2xl md:rounded-3xl shadow-2xl overflow-hidden">
                <img src="https://27.btm-m.site/cover.jpg" alt="Cover" class="w-full h-full object-cover rounded-2xl md:rounded-3xl shadow-glass" id="mainCover" onerror="this.src='https://placehold.co/400?text=27'">
                <!-- 倒影效果 -->
                <div class="absolute -bottom-4 left-4 right-4 h-4 bg-black/20 blur-xl rounded-[50%]"></div>
            </div>
            
            <!-- 信息区 -->
            <div class="text-center md:text-left space-y-1 w-full">
                <h1 class="text-2xl md:text-3xl font-bold tracking-tight text-white leading-tight">27 -DECO*27 Vocal Mix-</h1>
                <p class="text-lg text-white/60 font-medium">DECO*27</p>
                <div class="inline-flex items-center gap-2 px-2 py-0.5 rounded border border-white/20 text-[10px] font-bold text-white/50 uppercase tracking-wider mt-2">
                    Lossless
                </div>
            </div>

            <!-- 播放控制区 -->
            <div class="w-full space-y-4">
                <!-- 进度条 -->
                <div class="w-full space-y-2">
                    <div class="relative w-full h-1 group cursor-pointer" id="progressContainer">
                        <div class="absolute inset-0 bg-white/20 rounded-full"></div>
                        <div id="progressFill" class="absolute left-0 top-0 bottom-0 bg-white/90 rounded-full w-0 transition-all duration-100 shadow-[0_0_10px_rgba(255,255,255,0.5)]"></div>
                        <input type="range" id="progressBar" value="0" step="0.1" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                    </div>
                    <div class="flex justify-between text-xs font-mono text-white/50">
                        <span id="currentTime">0:00</span>
                        <span id="duration">0:00</span>
                    </div>
                </div>

                <!-- 按钮组 (居中对齐) -->
                <div class="flex items-center justify-center w-full gap-12">
                    <button id="skipBackBtn" class="text-white/60 hover:text-white transition transform active:scale-90 flex items-center justify-center">
                        <span class="material-symbols-rounded text-4xl">skip_previous</span>
                    </button>
                    <button id="playPauseBtn" class="text-white hover:scale-105 transition transform duration-200 flex items-center justify-center">
                        <span id="playIcon" class="material-symbols-rounded text-6xl">play_arrow</span>
                        <span id="pauseIcon" class="material-symbols-rounded text-6xl hidden">pause</span>
                    </button>
                    <button id="skipFwdBtn" class="text-white/60 hover:text-white transition transform active:scale-90 flex items-center justify-center">
                        <span class="material-symbols-rounded text-4xl">skip_next</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 右侧：歌词滚动区 -->
        <div id="lyricsContainer" class="lyrics-container w-full md:flex-1 h-[40vh] md:h-[80vh] overflow-y-auto no-scrollbar space-y-8 py-[20vh] md:py-[40vh] text-center md:text-left mask-linear">
            <!-- 歌词将通过 JS 插入 -->
        </div>

    </main>

    <audio id="audioPlayer" src="https://27.btm-m.site/audio.mp3" preload="metadata"></audio>

    <script>
        // Updated Lyrics Data with Time (seconds)
        const lyricsData = [
            { "time": 15.990, "jp": "なんだかすれ違い　あやふやになって、もう9月", "cn": "总觉得有些隔阂　关系变得模糊不清、已经9月了", "en": "Somehow we drifted apart, things got vague, and it's already September", "romaji": "nandaka surechigai　ayafuya ni natte, mou kugatsu", "kana": "なんだかすれちがい　あやふやになって、もうくがつ", "id": 1 },
            { "time": 22.820, "jp": "どちらが謝るか　意地貼ってたんだ　ペタペタと", "cn": "是谁先道歉呢　一直都在赌气　贴得死死的", "en": "Who's going to apologize? We were both being stubborn, sticking to our guns", "romaji": "dochira ga ayamaru ka　iji hatteta nda　petapeta to", "kana": "どちらがあやまるか　いじはってたんだ　ぺたぺたと", "id": 2 },
            { "time": 28.810, "jp": "それも今日で終わりなんだ　僕がお詫び申し上げる", "cn": "那也在今天结束了　由我来向你道歉", "en": "But that ends today, I'm offering my apology", "romaji": "sore mo kyou de owari nanda　boku ga owabi moushiageru", "kana": "それもきょうでおわりなんだ　ぼくがおわびもうしあげる", "id": 3 },
            { "time": 35.650, "jp": "君が好きなチーズケーキ　家で焼いてきたよ", "cn": "你喜欢的芝士蛋糕　我在家里烤好带来的哦", "en": "The cheesecake you like, I baked it at home and brought it here", "romaji": "kimi ga suki na chiizukeiki　ie de yaite kita yo", "kana": "きみがすきなちーずけーき　いえでやいてきたよ", "id": 4 },
            { "time": 42.130, "jp": "今日は君が生まれてから　何度目かの誕生日だよ", "cn": "今天是你出生后的　第几次生日了呢", "en": "Today marks another one of your birthdays since you were born", "romaji": "kyou wa kimi ga umarete kara　nandome ka no tanjoubi da yo", "kana": "きょうはきみがうまれてから　なんどめかのたんじょうびだよ", "id": 5 },
            { "time": 49.420, "jp": "ごめん、僕の意地貼りシール　ここで全部剥がすから", "cn": "抱歉、我的赌气贴纸　就在现在全部撕下来", "en": "Sorry, I'm peeling off all my \"stubborn stickers\" right here", "romaji": "gomen, boku no iji hari shiiru　koko de zenbu hagasu kara", "kana": "ごめん、ぼくのいじはりしーる　ここでぜんぶはがすから", "id": 6 },
            { "time": 56.240, "jp": "ロウソクの火を消そうとして　膨らんだ君の両頬が可愛くて", "cn": "想要吹灭蜡烛的火苗　你鼓起的脸颊好可爱", "en": "Trying to blow out the candle flame, your puffed-up cheeks were so cute", "romaji": "rousoku no hi o kesou to shite　fukuranda kimi no ryouhoho ga kawaikute", "kana": "ろうそくのひをけそうとして　ふくらんだきみのりょうほほがかわいくて", "id": 7 },
            { "time": 64.600, "jp": "僕はずっと消えなきゃいいなと思ったよ", "cn": "我想着要是永远不消失就好了", "en": "I thought to myself, I wish this moment would never disappear", "romaji": "boku wa zutto kienakya ii na to omotta yo", "kana": "ぼくはずっときえなきゃいいなとおもったよ", "id": 8 },
            { "time": 84.490, "jp": "アタシの誕生日　今日だったなんて、忘れてた", "cn": "我的生日　原来是今天啊、我都忘了", "en": "My birthday, I had forgotten it was today", "romaji": "atashi no tanjoubi　kyou datta nante, wasureteta", "kana": "あたしのたんじょうび　きょうだったなんて、わすれてた", "id": 9 },
            { "time": 91.340, "jp": "そういうとこズルい 「怒ってないよ^^」しか言えない。", "cn": "这种地方太狡猾了　只能说出「我不生气哦^^」。", "en": "That's unfair of you, I can only say \"I'm not angry ^^\"", "romaji": "souiu toko zurui \"okottenai yo^^\" shika ienai.", "kana": "そういうとこずるい 「おこってないよ^^」しかいえない。", "id": 10 },
            { "time": 97.400, "jp": "ええとでもね、一つだけ　これからのために言わせてもらいます", "cn": "那个但是呢、只有一件事　为了今后着想请让我说一句", "en": "Umm, but actually, just one thing, for the sake of our future let me say this", "romaji": "eeto demo ne, hitotsu dake　korekara no tame ni iwasete moraimasu", "kana": "ええとでもね、ひとつだけ　これからのためにいわせてもらいます", "id": 11 },
            { "time": 104.220, "jp": "アタシが好きなのはチーズケーキじゃなくて　苺の乗ったショートケーキ", "cn": "我喜欢的不是芝士蛋糕　而是放了草莓的奶油蛋糕", "en": "What I like isn't cheesecake, it's strawberry shortcake", "romaji": "atashi ga suki na no wa chiizukeiki ja nakute　ichigo no notta shootokeiki", "kana": "あたしがすきなのはちーずけーきじゃなくて　いちごののったしょーとけーき", "id": 12 },
            { "time": 124.410, "jp": "「マジで?!」と驚いた顔　忘れっぽいそんな所も", "cn": "「真的吗?!」那惊讶的表情　还有那健忘的地方", "en": "\"Seriously?!\" that surprised face, and that forgetful side of yours too", "romaji": "\"majide?!\" to odoroita kao　wasureppoi sonna tokoro mo", "kana": "「まじで?!」とおどろいたかお　わすれっぽいそんなところも", "id": 13 },
            { "time": 131.670, "jp": "大好きだよ　好きだけどさ　まだ忘れてるでしょ?", "cn": "最喜欢了哦　虽然喜欢　但你还忘了什么吧?", "en": "I love it all, I love you but, you're still forgetting something, right?", "romaji": "daisuki da yo　suki dakedo sa　mada wasureteru desho?", "kana": "だいすきだよ　すきだけどさ　まだわすれてるでしょ?", "id": 14 },
            { "time": 138.080, "jp": "本日は27日なり　二人が無事恋人になり", "cn": "今天是27日　两人顺利成为恋人", "en": "Today is the 27th, the day we safely became lovers", "romaji": "honjitsu wa ni-juu-shichi nichi nari　futari ga buji koibito ni nari", "kana": "ほんじつはにじゅうしちにちなり　ふたりがぶじこいびとになり", "id": 15 },
            { "time": 147.130, "jp": "何ヶ月か目の記念日　アタシが「好き。」って言った日よ", "cn": "第几个月的纪念日　是我说了「喜欢你。」的日子哦", "en": "The anniversary of some months passed, the day I said \"I like you.\"", "romaji": "nankagetsu ka me no kinenbi　atashi ga \"suki.\" tte itta hi yo",
            "kana": "なんかげつかめのきねんび　あたしが「すき。」っていったひよ", "id": 16 },
            { "time": 154.050, "jp": "「当たり前に覚えてるよ　僕が忘れるわけないじゃん」", "cn": "「理所当然记得啊　我怎么可能忘记嘛」", "en": "\"Of course I remember, there's no way I'd forget\"", "romaji": "\"atarimae ni oboeteru yo　boku ga wasureru wake nai jan\"", "kana": "「あたりまえにおぼえてるよ　ぼくがわすれるわけないじゃん」", "id": 17 },
            { "time": 161.090, "jp": "そう言って　取り出したケーキは　アタシの大好きな…", "cn": "这样说着　拿出来的蛋糕是　我最喜欢的…", "en": "Saying that, the cake you took out was my favorite...", "romaji": "sou itte　toridashita keiki wa　atashi no daisuki na...", "kana": "そういって　とりだしたけーきは　あたしのだいすきな…", "id": 18 },
            { "time": 167.680, "jp": "今日は君が生まれてから　何度目かの誕生日だよ", "cn": "今天是你出生后的　第几次生日了呢", "en": "Today marks another one of your birthdays since you were born", "romaji": "kyou wa kimi ga umarete kara　nandome ka no tanjoubi da yo", "kana": "きょうはきみがうまれてから　なんどめかのたんじょうびだよ", "id": 19 },
            { "time": 174.550, "jp": "ごめん、記念日も知ってたけどね…驚かせたくて(笑)", "cn": "抱歉、纪念日我也知道的…只是想给你个惊喜(笑)", "en": "Sorry, I knew about the anniversary too... I just wanted to surprise you (lol)", "romaji": "gomen, kinenbi mo shitteta kedo ne... odorokasetakute (wara)", "kana": "ごめん、きねんびもしってたけどね…おどろかせたくて(わら)", "id": 20 },
            { "time": 181.470, "jp": "泣いた顔を隠そうとして　俯いた君の前髪が可愛くて", "cn": "想要掩饰哭泣的脸　低着头的你的刘海好可爱", "en": "Trying to hide your crying face, your bangs as you looked down were so cute", "romaji": "naita kao o kakusou to shite　utsumuita kimi no maegami ga kawaikute", "kana": "ないたかおをかくそうとして　うつむいたきみのまえがみがかわいくて", "id": 21 },
            { "time": 189.820, "jp": "僕はずっと守っていくこと　誓ったよ", "cn": "我发誓会一直守护下去的", "en": "I swore that I would protect you forever", "romaji": "boku wa zutto mamotte iku koto　chikatta yo", "kana": "ぼくはずっとまもっていくこと　ちかったよ", "id": 22 },
            { "time": 197.000, "jp": "", "cn": "", "en": "", "romaji": "", "kana": "", "id": 23 },
            // Credits line - very high time so it's never active
            { "time": 999999, "jp": "创作者：DECO*27", "cn": "创作者：DECO*27", "en": "Creator: DECO*27", "romaji": "Creator: DECO*27", "kana": "Creator: DECO*27", "id": "credits", "isFooter": true }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            const initialLangs = ['jp', 'cn', 'en', 'romaji', 'kana'];
            let selectedLangs = ['jp', 'cn']; 
            const maxLangs = 2;
            let isUserScrolling = false;
            let scrollTimeout;
            
            const container = document.getElementById('lyricsContainer');
            const langBtns = document.querySelectorAll('.lang-btn');
            
            // --- UI Setup ---
            function updateLangUI() {
                langBtns.forEach(btn => {
                    const lang = btn.dataset.lang;
                    const isActive = selectedLangs.includes(lang);
                    if (isActive) {
                        btn.className = 'lang-btn px-3 py-1 rounded-full text-xs font-bold transition-all duration-300 bg-white text-black shadow-lg';
                    } else {
                        btn.className = 'lang-btn px-3 py-1 rounded-full text-xs font-semibold transition-all duration-300 hover:bg-white/10 text-white/60';
                    }
                });
            }

            langBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const lang = btn.dataset.lang;
                    if (selectedLangs.includes(lang)) {
                        if (selectedLangs.length > 1) {
                            selectedLangs = selectedLangs.filter(l => l !== lang);
                        }
                    } else {
                        if (selectedLangs.length < maxLangs) {
                            selectedLangs.push(lang);
                        } else {
                             selectedLangs.shift();
                             selectedLangs.push(lang);
                        }
                    }
                    const order = ['jp', 'cn', 'en', 'romaji', 'kana'];
                    selectedLangs.sort((a, b) => order.indexOf(a) - order.indexOf(b));
                    updateLangUI();
                    renderLyrics();
                });
            });

            // --- Scroll Detection ---
            container.addEventListener('scroll', () => {
                isUserScrolling = true;
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    isUserScrolling = false;
                }, 2000); // Resume auto-scroll after 2s of no interaction
            });

            function renderLyrics() {
                container.innerHTML = '';
                // Add top padding
                const topPad = document.createElement('div');
                topPad.style.height = "45vh";
                container.appendChild(topPad);

                lyricsData.forEach((row, index) => {
                    const rowDiv = document.createElement('div');
                    
                    // Special styling for footer
                    if (row.isFooter) {
                        rowDiv.className = "lyrics-footer py-4 px-4 text-sm font-medium transition-all duration-500 rounded-2xl";
                    } else {
                        rowDiv.className = "lyrics-row cursor-pointer py-4 px-4 transition-all duration-500 rounded-2xl hover:bg-white/5";
                    }
                    
                    rowDiv.dataset.id = row.id;
                    rowDiv.dataset.time = row.time; 
                    
                    // Footer usually just shows one line, but let's stick to selected langs for consistency or just show 'jp' which contains the text
                    if (row.isFooter) {
                        const p = document.createElement('p');
                        p.textContent = row.jp; // We put the credit string here
                        rowDiv.appendChild(p);
                    } else {
                        selectedLangs.forEach((lang, i) => {
                            if (!row[lang]) return;
                            const p = document.createElement('p');
                            p.textContent = row[lang];
                            if (i === 0) {
                                p.className = "text-2xl md:text-3xl lg:text-4xl font-bold mb-2 leading-tight tracking-tight";
                            } else {
                                p.className = "text-lg md:text-xl font-medium text-white/60 leading-relaxed";
                            }
                            
                            if (lang === 'cn') p.classList.add('font-[Noto_Sans_SC]');
                            else if (lang === 'jp') p.classList.add('font-[Noto_Sans_JP]');
                            
                            rowDiv.appendChild(p);
                        });

                        // Click to seek (only for lyrics)
                        rowDiv.addEventListener('click', (e) => {
                            audio.currentTime = row.time;
                            if(audio.paused) audio.play();
                            updateActiveLyric(row.id);
                            scrollToActiveLine(rowDiv);
                        });
                    }
                    
                    container.appendChild(rowDiv);
                });
                
                // Add bottom padding
                const bottomPad = document.createElement('div');
                bottomPad.style.height = "50vh";
                container.appendChild(bottomPad);
            }

            // --- Audio Logic ---
            const audio = document.getElementById('audioPlayer');
            const playPauseBtn = document.getElementById('playPauseBtn');
            const playIcon = document.getElementById('playIcon');
            const pauseIcon = document.getElementById('pauseIcon');
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            const currentTimeEl = document.getElementById('currentTime');
            const durationEl = document.getElementById('duration');

            function togglePlay() {
                if (audio.paused) audio.play();
                else audio.pause();
            }

            function updatePlayState() {
                if (audio.paused) {
                    playIcon.classList.remove('hidden');
                    pauseIcon.classList.add('hidden');
                } else {
                    playIcon.classList.add('hidden');
                    pauseIcon.classList.remove('hidden');
                }
            }

            function formatTime(s) {
                if(isNaN(s)) return "0:00";
                const m = Math.floor(s/60), sec = Math.floor(s%60);
                return `${m}:${sec<10?'0':''}${sec}`;
            }

            // --- Synced Lyrics Logic ---
            let currentActiveIndex = -1;

            function updateActiveLyric(forceId = null) {
                let activeIndex = -1;
                const currentTime = audio.currentTime;

                if (forceId) {
                    activeIndex = lyricsData.findIndex(r => r.id === forceId);
                } else {
                    // Ignore footer in sync logic
                    for (let i = 0; i < lyricsData.length; i++) {
                        if (lyricsData[i].isFooter) continue; 
                        
                        if (currentTime >= lyricsData[i].time) {
                            activeIndex = i;
                        } else {
                            break;
                        }
                    }
                }

                if (activeIndex !== -1 && activeIndex !== currentActiveIndex) {
                    currentActiveIndex = activeIndex;
                    
                    const allRows = container.querySelectorAll('.lyrics-row, .lyrics-footer'); // Select footer too to reset it if needed
                    allRows.forEach((row) => {
                        // Check if it's the active row based on ID match
                        // activeIndex points to lyricsData index.
                        // We need to match dataset.id because dom elements include padding divs? 
                        // Actually querySelectorAll doesn't include padding divs.
                        
                        // Let's use ID matching for safety
                        if (row.dataset.id == lyricsData[activeIndex].id) {
                            row.classList.add('active');
                            row.classList.remove('inactive');
                            
                            if (!isUserScrolling) {
                                scrollToActiveLine(row);
                            }
                        } else {
                            row.classList.remove('active');
                            if (!row.classList.contains('lyrics-footer')) {
                                row.classList.add('inactive');
                            }
                        }
                    });
                }
            }

            function scrollToActiveLine(element) {
                const containerHeight = container.clientHeight;
                const elementHeight = element.clientHeight;
                const offsetTop = element.offsetTop;
                
                const scrollPos = offsetTop - (containerHeight / 2) + (elementHeight / 2);
                
                container.scrollTo({
                    top: scrollPos,
                    behavior: 'smooth'
                });
            }

            playPauseBtn.addEventListener('click', togglePlay);
            audio.addEventListener('play', updatePlayState);
            audio.addEventListener('pause', updatePlayState);
            
            audio.addEventListener('timeupdate', () => {
                const pct = (audio.currentTime / audio.duration) * 100 || 0;
                progressBar.value = pct;
                progressFill.style.width = pct + '%';
                currentTimeEl.textContent = formatTime(audio.currentTime);
                
                updateActiveLyric();
            });
            
            audio.addEventListener('loadedmetadata', () => {
                durationEl.textContent = formatTime(audio.duration);
            });
            
            progressBar.addEventListener('input', (e) => {
                const pct = e.target.value;
                progressFill.style.width = pct + '%';
                audio.currentTime = (pct / 100) * audio.duration;
            });

            document.getElementById('skipBackBtn').addEventListener('click', () => audio.currentTime -= 10);
            document.getElementById('skipFwdBtn').addEventListener('click', () => audio.currentTime += 10);

            // Init
            updateLangUI();
            renderLyrics();
        });
    </script>
</body>
</html>